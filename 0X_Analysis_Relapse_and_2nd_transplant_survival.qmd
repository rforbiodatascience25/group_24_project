---
title: "0X_Analysis_Relapse_and_2nd_transplant_survival"
format: html
editor: visual
---

# Relapse & Second Transplant vs. Survival of Patients

Dataset: *Bone Marrow Transplantation: Children*

We want to look at the relationship between relapse and secondary transplants in patients and how it affects their odds of survival.

To Do this, we look at how many relapsed, needed a second transplant, and how many of them survived and when they where observed. This is done using 4 variables taken from the cleaned augmented dataset, described in table 1, and then performing an analysis of the relationship between them.

| Variable | Description | Value |
|:--:|:--:|:--:|
| `Txpostrelapse` | Second Bone Marrow transplantation after relapse | Yes or No |
| `Relapse` | Reoccurance of disease | Yes or No |
| `survival_time` | Time of Observation (Alive) or time of event in days (Dead) | Yes or No |
| `survival_status` | Survival status | Yes or No |

: Table 1: The data used for this analysis is `03_dat_aug` using these variables:`Txpostrelapse`, `Relapse`, `survival_time`& `survival_status`.

## Data Wrangling

### Initiate Libraries

We start by loading the relevant libraries.

`{r} library(tidyverse)}`

We then load a subset of the cleaned and augmented data frame as a tibble containing only our 4 variables.

```{r}

bm_data <- read_tsv(file = "data/03_dat_aug.tsv",
                    col_select = c("Txpostrelapse",
                                   "Relapse",
                                   "survival_time",
                                   "survival_status"),
                    show_col_types = FALSE)



```

It contains the 4 columns we are interested in, 186 datapoints for each, and does not contain any NA / missing values.

```{r}
bm_data
```

## Data Analysis

First we want to look at the relationship between survival of patients and the time of observation or event. This is done by visualizing `survival_time` based on `survival_status` in `bm_data`.

```{r}
#| label: Boxplot of time of survival stradified by survival status

bm_data |>
  ggplot(data = _,
         mapping = aes(x = survival_status,
                       y = survival_time,
                       fill = survival_status)) +
  geom_boxplot(alpha = 0.5) + 
  labs(x = "Survival Status",
       y = "Survival Time [days]",
       title = "Time differences in days between good and bad outcomes for Patients",
       subtitle = "Time stamps are either Observations for living Patients and Events for dead Patients",
       caption = "Data from the Bone Marrow Transplantation: Children dataset") +
  theme_minimal(base_family = "Avenir", 
                base_size = 12) +
  theme(legend.position = "Bottom")
  
```

We can see that Patients with bad outcomes die within ADD STATISTICS days and observations taken from patients with good outcomes usually happen around ADD STATISTICS day. This says something about the observation time needed to see if an rejection of the transplantation happens.

### Relapse in Relation to Survival

Next we will look at the rate of relapses and how it relates to survival status of patients.

```{r}

bm_data |>
  count(survival_status,Relapse) |>
  ggplot(mapping = aes(x = Relapse,
                       y = n,
                       fill = survival_status)) +
  geom_col(position = position_dodge(
    preserve = "single"),
    colour = "black",
    alpha = 0.5) +
  geom_hline(yintercept = 0) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom",
        panel.grid.major.x = element_blank())
  

  
```

## Random Notes (REMOVE LATER!)

Old plots not edited

100000 -\> used as placeholder for nothing in some columns

Augment (PCA): time_to_aGvHD_III_IV,

lm - function,

Gendermatch -\> ung men prefered, sensitation

HLAmatch

**subdataset**

group together to see if dead or observation

-   survival_time

Time of observation (if alive) or time to event (if dead) in days

-   survival_status

Survival status (0 - alive, 1 - dead)

psudosample number

first or second transplant

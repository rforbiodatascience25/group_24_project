---
title: "08_analysis_PCA_HLA"
format: html
---

## PCA and HLA Matching analysis

Initial analysis of bone-marrow data

#### Load libraries and data

```{r}
library(tidyverse)
library(broom)
library(ggrepel)
library(ggridges)
library(patchwork)

bm_data <- read_tsv(file = "data/03_dat_aug.tsv.gz", 
                    show_col_types = FALSE, na = "100000")  |>
  mutate(across(c(1:2, 4:22, 24:26, 35), factor)) |>
  mutate(across(c(3,23,27:34), as.integer)) |>
  select(- time_to_aGvHD_III_IV) |>
  drop_na(where(is.numeric))
```

The time to GvGD column has been dropped as only a few number of the patients develop the disease. Thus, to ensure that the PCA analysis is based on as many observations as possible, the variable is left out.

```{r}
pca_fit <- bm_data |>
  select(where(is.numeric)) |>
  drop_na() |>
  prcomp(scale = TRUE)

r_matrix <- pca_fit |>
  tidy(matrix = "rotation")|>
  pivot_wider(names_from = "PC", names_prefix = "PC", values_from = "value")

pca_plot <- pca_fit |>
  augment(bm_data) |>
  ggplot(aes(x = .fittedPC1, 
             y = .fittedPC2, 
             colour = survival_status)) +
  geom_point(size = 1.5) +
  labs(x = "PC1 (31,2%)",
       y = "PC2 (15,5%)", 
       colour = "Survival Status",
       title = "Scores Plot") +
  scale_colour_viridis_d() +
  theme_minimal() +
  theme(legend.position = "bottom") 

pca_plot
ggsave("result/pca_plot.png", width = 6 )


```

The PC-scores plot shows that there is no clear separation between the samples based on the survival status and thus, the groups are not distinguishable based on the first two principal components.